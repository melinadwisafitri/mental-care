<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link rel = "stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel=stylesheet type=text/css href="/static/style/chats.css">
    </head>
    <body>
        <div class="container mt-2 card">
            <nav class="card-header navbar chat-header ">
                <ul class="navbar chat-header-item">
                    <li class="nav-item avatar rounded-circle">
                        <img src="/static/assets/bot.png" alt="avatar-bot">
                    </li>
                    <li class="nav-item chat-header-name">
                        <h4>Melbo</h4>
                    </li>
                </ul>
                <ul class="navbar">
                    <li class="nav-item">
                        <a href="#info" class="fa fa-info"></a>
                    </li>
                    <li class="nav-item" style="padding-left: 50px;">
                        <a href="#close" class="fa fa-close"></a>
                    </li>
                </ul>
            </nav>
            <div class="chat-body">
                <div id='chat-default' class="chat-body-system row">
                    <div class="col-2">
                        <div class="avatar rounded-circle">
                            <img src="static/assets/bot.png" alt="avatar-bot">
                        </div>
                    </div>
                    <div class="col-7">
                        <div class="chat-body-system-text">
                            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Quo dolor cumque sequi sit nemo voluptatibus odit neque corrupti, repudiandae rem vitae ullam quibusdam velit deleniti est aliquid repellat? Earum, reprehenderit.</p>
                        </div>
                    </div>
                </div>
                <div id ="chat-user">
                    <!--<div class="col-7">
                        <div class="chat-body-user-text">
                            <p>Lorem</p>
                        </div>
                    </div>
                    <div class="col-2">
                        <div class="avatar rounded-circle">
                            <img src="src/assets/bot.png" alt="avatar-bot">
                        </div>
                    </div>-->
                </div>
                <div id="chat-system">

                </div>
                
            </div>
            <div class="chat-button row">
                <input id='input-question' type="text" class="col">
                <div class="col-1">
                    <!--<p id="btn-sub" class="fa fa-send col-3"></p>-->
                    <input type="submit" id="btn-send" value='âœ”' class="button rounded-circle">
                </div>
            </div>
        </div>
    <!--<script src="/static/js/api_call.js">-->
        <script type="text/javascript">
            const btn = document.querySelector('#btn-send')
            const chat = document.querySelector('#input-question').value
            const chatList = document.querySelector('#chat-user')
            btn.addEventListener('click', () => {
                const xhr = new XMLHttpRequest();
                xhr.onload = () => {
                    getDataChat()
                }
                xhr.open('POST', '/try', true)
                xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded;charset=UTF-8')
                //xhr.send(JSON.stringify({question : chat}))
                console.log(document.querySelector('#input-question').value)
                xhr.send('question=' + chat)

            })

            const getDataChat = () => {
                const xhr = new XMLHttpRequest()
                xhr.onload = function() {
                    const responseJson = JSON.parse(this.responseText);
                    renderChat(responseJson)
                    console.log(responseJson)
                }
                xhr.onerror = () => {
                    console.log(error)
                }

                xhr.open("GET", '/try')
                xhr.send()
            }

            const renderChat = (msg) => {
                const chatList = document.querySelector('#chat-user')
                const q = document.querySelector('#input-question').value
                chatList.innerHTML +=  `<div class="chat-body-user row">
                    <div class="col-7">
                        <div class="chat-body-user-text">
                            <p>${q}</p>
                        </div>
                    </div>
                    <div class="col-2">
                        <div class="avatar rounded-circle">
                            <img src="static/assets/bot.png" alt="avatar-bot">
                        </div>
                    </div>
                </div>
                <div id='chat-default' class="chat-body-system row">
                    <div class="col-2">
                        <div class="avatar rounded-circle">
                            <img src="static/assets/bot.png" alt="avatar-bot">
                        </div>
                    </div>
                    <div class="col-7">
                        <div class="chat-body-system-text">
                            <p>${msg.answer}</p>
                    </div>`
            }
        </script>
    </body>
</html>